function ZFGTMUtil(){this.gtmJSON={},this.postMsgJSON={}}var GTM={CATEGORY:"Zoho Forms",FORM_SUBMIT:"Submit Form",FORM_SUBMIT_EVT:"zf_submitform",FIELD_ONCLK:"Onclick Field",FIELD_ONCLK_EVT:"zf_onclickfield",PAGE_VIEW:"Page View",PAGE_VIEW_EVT:"zf_pageview",SAVE_FORM:"Save Form",SAVE_FORM_EVT:"zf_saveform",REVIEW_FORM:"Review Form",REVIEW_FORM_EVT:"zf_reviewform",FORM_VIEW_EVT:"zf_formview",FORM_VIEW:"Form View",FORM_ALIAS:"form_alias",FIELDS:"fields",PAGES:"pages",FORM_VIEW_KEY:"form_view",FORM_REVIEW_KEY:"form_review",FORM_SAVE_KEY:"form_save",FORM_SUBMIT_KEY:"form_submit",ZF_GTM:"zf_gtm",DATAPUSH_FLDS:"datapush_flds"};function bindFieldstoEvt(liElem,fieldLinkName,compType){if(!$(liElem).hasOwnProperty("isvisible")||"true"==$(liElem).attr("isvisible"))if($(liElem).hasClass("fieldDisabled"))compType==ZFFieldTypeConstants.ADDRESS&&$(liElem).on("click","a[elname=mapLink]",function(){pushToGTM(this)});else if(compType==ZFFieldTypeConstants.SINGLE_LINE||compType==ZFFieldTypeConstants.EMAIL||compType==ZFFieldTypeConstants.WEBSITE||compType==ZFFieldTypeConstants.PHONE||compType==ZFFieldTypeConstants.NUMBER||compType==ZFFieldTypeConstants.CURRENCY||compType==ZFFieldTypeConstants.DECIMAL||compType==ZFFieldTypeConstants.DATETIME||compType==ZFFieldTypeConstants.DATE)$(liElem).on("focus","input",function(){pushToGTM(this)});else if(compType==ZFFieldTypeConstants.MULTI_LINE)$(liElem).on("focus","textarea",function(){pushToGTM(this)});else if(compType==ZFFieldTypeConstants.RATING)$(liElem).on("click","a,span",function(){pushToGTM(this)});else if(compType==ZFFieldTypeConstants.SLIDER)$(liElem).find("a").parent().on("slidestop",function(){pushToGTM(this)});else if(compType==ZFFieldTypeConstants.RADIO||compType==ZFFieldTypeConstants.CHECKBOX||compType==ZFFieldTypeConstants.DECISION_BOX||compType==ZFFieldTypeConstants.TERMS_CONDITIONS)$(liElem).on("change","input",function(){pushToGTM(this)});else if(compType==ZFFieldTypeConstants.YES_OR_NO)$(liElem).on("click","a,span",function(){pushToGTM(this)});else if(compType==ZFFieldTypeConstants.NAME||compType==ZFFieldTypeConstants.ADDRESS)$(liElem).on("change","select",function(){pushToGTM(this)}),$(liElem).on("focus","input",function(){pushToGTM(this)}),$(liElem).on("click","a[elname=mapLink]",function(){pushToGTM(this)});else if(compType==ZFFieldTypeConstants.TIME||compType==ZFFieldTypeConstants.DROPDOWN||compType==ZFFieldTypeConstants.MULTIPLE_CHOICE)$(liElem).on("change","select",function(){pushToGTM(this)});else if(compType==ZFFieldTypeConstants.IMAGE_CHOICE)if(isNewHtmlDOM()){var divEle=liElem.find("div[elname=choiceContDiv]");$(divEle).each(function(){$(this).on("click",function(){pushToGTMImgChoice(this)})})}else{if("imagePicker"==(choiceType=liElem.find("div[elname=imageChoiceEle]").attr("choicetype"))){divEle=liElem.find("div[elname=choiceContDiv]");$(divEle).each(function(){$(this).find("div[name=selectDiv]").on("click",function(){pushToGTM(this)}),$(this).find("b").on("click",function(){pushToGTM(this)})})}else{var inputs=liElem.find("input");$(inputs).each(function(){var parentDiv=$(this).closest("div[elname=choicesDiv]");$(this).on("click",function(){pushToGTM(this)}),$(parentDiv).find("div").on("click",function(){pushToGTM(this)}),$(parentDiv).find("b").on("click",function(){pushToGTM(this)})})}}else if(compType==ZFFieldTypeConstants.FILE_UPLOAD)$(liElem).find("input[name="+fieldLinkName+"]").on("change",function(){pushToGTM(this)});else if(compType==ZFFieldTypeConstants.IMAGE_UPLOAD||compType==ZFFieldTypeConstants.SMART_SCAN||compType==ZFFieldTypeConstants.MEDIA_UPLOAD)$(liElem).find("input[name="+fieldLinkName+"]").on("change",function(){pushToGTM(this)});else if(compType==ZFFieldTypeConstants.SIGNATURE)$(liElem).find("#drawingCanvas-"+fieldLinkName).on("mousedown",function(event){pushToGTM(this)});else if(compType==ZFFieldTypeConstants.MATRIX_CHOICE){var choiceType;(choiceType=$(liElem).attr("choicetype"))==MatrixChoicesType.TEXTBOX.CODE||choiceType==MatrixChoicesType.NUMBER.CODE||choiceType==MatrixChoicesType.CURRENCY.CODE?$(liElem).find("input[elname="+fieldLinkName+"]").on("focus",function(){pushToGTM(this)}):choiceType==MatrixChoicesType.DROPDOWN.CODE?$(liElem).find("select[elname="+fieldLinkName+"]").on("change",function(){pushToGTM(this)}):$(liElem).find("input[elname="+fieldLinkName+"]").on("change",function(){pushToGTM(this)})}}function pushToGTMImgChoice(input){if(isNewHtmlDOM()){var target=event.target;if($(target).closest('a[elname="zoom"]').length>0)return}pushToGTM(input)}function pushToGTM(input){var elem=getClosestFieldElemLi(input),fieldLinkName=$(elem).attr("linkname");if(!$.isEmptyObject(ZFGTMUtil.gtmJSON)){var onclickFldsGTM=ZFGTMUtil.gtmJSON[GTM.FIELDS];!$.isEmptyObject(onclickFldsGTM)&&onclickFldsGTM.hasOwnProperty(fieldLinkName)&&pushDataToDataLayerOrParent(GTM_TYPE.INLINE,GTM.FIELD_ONCLK_EVT,GTM.FIELD_ONCLK,"",onclickFldsGTM[fieldLinkName],"")}if(!$.isEmptyObject(ZFGTMUtil.postMsgJSON)){var onclickFldsPostMsg=ZFGTMUtil.postMsgJSON[GTM.FIELDS];!$.isEmptyObject(onclickFldsPostMsg)&&onclickFldsPostMsg.hasOwnProperty(fieldLinkName)&&pushDataToDataLayerOrParent(GTM_TYPE.POST_MSG,GTM.FIELD_ONCLK_EVT,GTM.FIELD_ONCLK,"",onclickFldsPostMsg[fieldLinkName],"")}}function pushToGTMOnClickWithFieldLinkName(fieldLinkName){if(!$.isEmptyObject(ZFGTMUtil.gtmJSON)){var onclickFldsGTM=ZFGTMUtil.gtmJSON[GTM.FIELDS];!$.isEmptyObject(onclickFldsGTM)&&onclickFldsGTM.hasOwnProperty(fieldLinkName)&&pushDataToDataLayerOrParent(GTM_TYPE.INLINE,GTM.FIELD_ONCLK_EVT,GTM.FIELD_ONCLK,"",onclickFldsGTM[fieldLinkName],"")}if(!$.isEmptyObject(ZFGTMUtil.postMsgJSON)){var onclickFldsPostMsg=ZFGTMUtil.postMsgJSON[GTM.FIELDS];!$.isEmptyObject(onclickFldsPostMsg)&&onclickFldsPostMsg.hasOwnProperty(fieldLinkName)&&pushDataToDataLayerOrParent(GTM_TYPE.POST_MSG,GTM.FIELD_ONCLK_EVT,GTM.FIELD_ONCLK,"",onclickFldsPostMsg[fieldLinkName],"")}}function pushDataToDataLayerOrParent(type,eventName,action,pageName,fieldName,dataToBePushed){try{type==GTM_TYPE.INLINE?window.dataLayer.push({event:eventName,zf_category:GTM.CATEGORY,zf_page:pageName,zf_field:fieldName,zf_action:action,zf_formname:ZFGTMUtil.gtmJSON[GTM.FORM_ALIAS]}):isNewHtmlDOM()&&type==GTM_TYPE.POST_MSG&&parent.postMessage({type:GTM.ZF_GTM,payload:{e:eventName,c:GTM.CATEGORY,p:pageName,f:fieldName,a:action,n:ZFGTMUtil.postMsgJSON[GTM.FORM_ALIAS],d:dataToBePushed}},"*")}catch(e){}}function pushPageViewToGTM(ulFooter){var pageLinkName=$(ulFooter).attr("page_link_name");if(!$.isEmptyObject(ZFGTMUtil.gtmJSON)){var pageViewGTM=ZFGTMUtil.gtmJSON[GTM.PAGES];!$.isEmptyObject(pageViewGTM)&&pageViewGTM.hasOwnProperty(pageLinkName)&&pushDataToDataLayerOrParent(GTM_TYPE.INLINE,GTM.PAGE_VIEW_EVT,GTM.PAGE_VIEW,pageViewGTM[pageLinkName],"","")}if(!$.isEmptyObject(ZFGTMUtil.postMsgJSON)){var pageViewPostMsg=ZFGTMUtil.postMsgJSON[GTM.PAGES];!$.isEmptyObject(pageViewPostMsg)&&pageViewPostMsg.hasOwnProperty(pageLinkName)&&pushDataToDataLayerOrParent(GTM_TYPE.POST_MSG,GTM.PAGE_VIEW_EVT,GTM.PAGE_VIEW,pageViewPostMsg[pageLinkName],"","")}}function pushFormViewToGTM(){$.isEmptyObject(ZFGTMUtil.gtmJSON)||ZFGTMUtil.gtmJSON[GTM.FORM_VIEW_KEY]&&pushDataToDataLayerOrParent(GTM_TYPE.INLINE,GTM.FORM_VIEW_EVT,GTM.FORM_VIEW,"","",""),$.isEmptyObject(ZFGTMUtil.postMsgJSON)||ZFGTMUtil.postMsgJSON[GTM.FORM_VIEW_KEY]&&pushDataToDataLayerOrParent(GTM_TYPE.POST_MSG,GTM.FORM_VIEW_EVT,GTM.FORM_VIEW,"","","")}function hasGTMSubmitEvent(){return!($.isEmptyObject(ZFGTMUtil.gtmJSON)||!ZFGTMUtil.gtmJSON[GTM.FORM_SUBMIT_KEY])||!($.isEmptyObject(ZFGTMUtil.postMsgJSON)||!ZFGTMUtil.postMsgJSON[GTM.FORM_SUBMIT_KEY])}function pushFormActionToGTM(input){if("submit"==input){if($.isEmptyObject(ZFGTMUtil.gtmJSON)||ZFGTMUtil.gtmJSON[GTM.FORM_SUBMIT_KEY]&&pushDataToDataLayerOrParent(GTM_TYPE.INLINE,GTM.FORM_SUBMIT_EVT,GTM.FORM_SUBMIT,"","",""),!$.isEmptyObject(ZFGTMUtil.postMsgJSON)&&ZFGTMUtil.postMsgJSON[GTM.FORM_SUBMIT_KEY]){var dataPushFlds=ZFGTMUtil.postMsgJSON[GTM.DATAPUSH_FLDS],dataToBePushed={};$.isEmptyObject(dataPushFlds)||$.each(dataPushFlds,function(fieldLinkName,fieldAlias){if(!$.isEmptyObject(ZFLive.valueJson[fieldLinkName]))if("object"==typeof ZFLive.valueJson[fieldLinkName]){var supportedCompNames=["AddressLine1","AddressLine2","City","Region","Country","ZipCode","First","Last","Middle","Salutation"],elementJson=ZFLive.valueJson[fieldLinkName];$.each(elementJson,function(compLinName,compValue){var compName=compLinName.split("_")[1];supportedCompNames.includes(compName)&&""!=compValue&&(compLinName=fieldAlias+"_"+compName.toLowerCase(),dataToBePushed[compLinName]=compValue)})}else dataToBePushed[fieldAlias]=ZFLive.valueJson[fieldLinkName],fieldLinkName.includes("PhoneNumber")&&(fieldLinkName+="_country_code",fieldAlias+="_country_code",$.isEmptyObject(ZFLive.valueJson[fieldLinkName])||(dataToBePushed[fieldAlias]=ZFLive.valueJson[fieldLinkName]))}),pushDataToDataLayerOrParent(GTM_TYPE.POST_MSG,GTM.FORM_SUBMIT_EVT,GTM.FORM_SUBMIT,"","",dataToBePushed)}}else"save"==input?($.isEmptyObject(ZFGTMUtil.gtmJSON)||ZFGTMUtil.gtmJSON[GTM.FORM_SAVE_KEY]&&pushDataToDataLayerOrParent(GTM_TYPE.INLINE,GTM.SAVE_FORM_EVT,GTM.SAVE_FORM,"","",""),$.isEmptyObject(ZFGTMUtil.postMsgJSON)||ZFGTMUtil.postMsgJSON[GTM.FORM_SAVE_KEY]&&pushDataToDataLayerOrParent(GTM_TYPE.POST_MSG,GTM.SAVE_FORM_EVT,GTM.SAVE_FORM,"","","")):"review"==input&&($.isEmptyObject(ZFGTMUtil.gtmJSON)||ZFGTMUtil.gtmJSON[GTM.FORM_REVIEW_KEY]&&pushDataToDataLayerOrParent(GTM_TYPE.INLINE,GTM.REVIEW_FORM_EVT,GTM.REVIEW_FORM,"","",""),$.isEmptyObject(ZFGTMUtil.postMsgJSON)||ZFGTMUtil.postMsgJSON[GTM.FORM_REVIEW_KEY]&&pushDataToDataLayerOrParent(GTM_TYPE.POST_MSG,GTM.REVIEW_FORM_EVT,GTM.REVIEW_FORM,"","",""))}ZFGTMUtil.prototype.bindGTMEvents=function(){var onClickFieldsArr=ZFGTMUtil.onClickFieldsArr;for(var fieldIndex in onClickFieldsArr){var fieldLinkName=onClickFieldsArr[fieldIndex],liElem=getFieldElem(fieldLinkName);if($(liElem).length>0)bindFieldstoEvt(liElem,fieldLinkName,parseInt($(liElem).attr("comptype")))}if(!isOneFieldForm()){var formDiv=isStandardForm()?$("div[elname=formWrapper]"):$("#formDiv");if((isStandardForm()?$(formDiv).find("#formBodyDiv").find("div[elname=formBodyULName]").length:$(formDiv).find("#formBodyDiv").find("ul[elname=formBodyULName]").length)>1)pushPageViewToGTM(isStandardForm()?$(formDiv).find("div[elname=footer][page_no=1]"):formDiv.find("ul[elname=footer][page_no=1]"))}pushFormViewToGTM()};